# Publish Workflow for .NET NuGet Library / .NET Tool

## Prerequisites

* Required environment variables:
  * `NUGET_API_KEY` - Nuget source API key (authentication).
  * `NUGET_SOURCE` - NuGet source.

## High-level CI Workflow Composition

The `publish` workflow needs to:

* Push the NuGet package to the remote NuGet source.

## CI Environment

The following [`ciEnvironment` configuration][opinionated project structure] is expected with this recipe.

```json
{
  "ciEnvironment": {
    "variables": [
      {
        "name": "NUGET_API_KEY",
        "description": "NuGet API Key",
        "required": true,
        "secret": true,
        "defaultValue": null
      },
      {
        "name": "NUGET_SOURCE",
        "description": "NuGet Source, e.g., 'nuget.org'",
        "required": true,
        "secret": false,
        "defaultValue": "nuget.org"
      }
    ]
  }
}
```

## Bash CI Workflow Compositions

> Build output:
>
> * _Project root_`/build/nuget/` - NuGet package(s) generated by `dotnet pack`.

### Using [Shell Library][shell library] Actions

> The CI [shell library][] assumes that the NuGet packages which will be published are stored at _Project root_`/build/nuget/`.

```bash
#--
# Publish the project's artifact composition.
#--
ci-publish() {
  ci-dotnet-nuget-push
}
```

### Using [Shell Library][shell library] Environment Variables

> This example is functionally equivalent to the "shell library actions" version above.

```bash
#--
# Publish the project's artifact composition.
#--
ci-publish() {
  for packageFile in "${BUILD_PACKAGED_DIST}"/nuget/*.nupkg; do
    dotnet nuget push "${packageFile}" --api-key "${NUGET_API_KEY}" --source "${NUGET_SOURCE}" &&
      printf "\n  Pushed '%s'" "${packageFile}"
  done
}
```

[opinionated project structure]: ../../use/project-structure.md
[shell library]: ../../use/ci-library.md
